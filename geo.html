<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>open street map and open layers</h1>
    

<button id="find">Показать широту и долготу</button><br />
<button id="count">Растояние</button><br />
    <p id="status"></p>
    <p id="distance"></p>
    <a id="map" target="_blank"></a>
    <div id="demoMap" style="height:650px"></div>
    <script src="OpenLayers-2.13.1/OpenLayers.js"></script>
    <script>
      function geoFindMe() {
        let status = document.querySelector("#status");
        let mapLink = document.querySelector("#map");
        mapLink.href = "";
        mapLink.innerHTML = "";
        distance.innerHTML = "";
        function success(position) {
          let latitude = position.coords.latitude;
          let longitude = position.coords.longitude;
          status.innerHTML = "";
          mapLink.href ="https://www.openstreetmap.org/#map=18/" +
            latitude + "/" + longitude;
          mapLink.innerHTML =
            "Latitude:" + latitude + " °, Longitude: " + longitude + "°";
        }

        function error() {
          status.innerHTML = "Невозможно получить данные геолокации.";
        }

        if (!navigator.geolocation) {
          status.innerHTML = "Геолокация не поддерживается вашим браузером.";
        } else {
          status.innerHTML = "Идет поиск…";
          navigator.geolocation.getCurrentPosition(success, error);
        }
      }
// привязка действий к кнопкам
      document.querySelector("#find").addEventListener("click", geoFindMe);
      document.querySelector("#count").addEventListener("click", schowdistance);

      //-->

      let latitude = 47.35387; // широта
let longitude = 8.43609; // долгота
let zoom = 18; // зум

let fromProjection = new OpenLayers.Projection("EPSG:4326"); // Преобразование из WGS 1984
let toProjection = new OpenLayers.Projection("EPSG:900913"); // к сферической проекции Меркатора

// расчет позиционирования
let position = new OpenLayers.LonLat(longitude, latitude).transform(
 fromProjection,
 toProjection
);

map = new OpenLayers.Map("demoMap");
let mapnik = new OpenLayers.Layer.OSM();
map.addLayer(mapnik);

// добавляем маркеры
let markers = new OpenLayers.Layer.Markers("Markers");
map.addLayer(markers);
markers.addMarker(new OpenLayers.Marker(position));
map.setCenter(position, zoom);

  //-->

function success(position) {
          latitude = position.coords.latitude; // перерасчет координат
          longitude = position.coords.longitude; // перерасчет координат

          status.innerHTML = "";

          mapLink.href = "https://www.openstreetmap.org/#map=18/" +
            latitude + "/" + longitude;

          mapLink.innerHTML =
            "Latitude:" + latitude + " °, Longitude: " + longitude + "°";

          // перерасчет позиционирования
          position = new OpenLayers.LonLat(longitude, latitude).transform(
            fromProjection, toProjection
          );

          // добавляем маркеры
          markers.addMarker(new OpenLayers.Marker(position)); 
          map.setCenter(position, zoom);
        }

        function error() {
          status.innerHTML = "Невозможно получить данные геолокации.";
        }

        if (!navigator.geolocation) {
          status.innerHTML = "Геолокация не поддерживается вашим браузером.";
        } else {
          status.innerHTML = "Идет поиск…";
          navigator.geolocation.getCurrentPosition(success, error);
        }
      
        function getDistanceFromLatLonInKm(lat1,lon1,lat2,lon2) {
  let R = 6371; // Radius of the earth in km
  let dLat = deg2rad(lat2-lat1);  // deg2rad below
  let dLon = deg2rad(lon2-lon1); 
  let a = 
    Math.sin(dLat/2) * Math.sin(dLat/2) +
    Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * 
    Math.sin(dLon/2) * Math.sin(dLon/2); 
  let c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
  let d = R * c; // Distance in km
  return d;
}

function deg2rad(deg) {
  return deg * (Math.PI/180)
}

function schowdistance(){
    distance.innerHTML += getDistanceFromLatLonInKm(latitude,longitude,36.25694,50.02513);
}
    </script>

</body>
</html>